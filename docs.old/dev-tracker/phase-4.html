<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 1: Foundation - TankerMade Dev Tracker</title>

    <!-- Preload resources -->
    <link rel="preload" href="shared.css" as="style">
    <link rel="preload" href="shared.js" as="script">

    <!-- Prevent FOUC -->
    <style>
        body {
            opacity: 0;
            transition: opacity 0.15s ease-in;
        }

            body.loaded {
                opacity: 1;
            }
    </style>

    <link rel="stylesheet" href="shared.css">
    <script src="shared.js" defer></script>
</head>
<body>
    <!-- Header and nav will be injected here by JavaScript -->
    <div id="header-nav-placeholder"></div>

    <main>
        <div class="container">
            <h1>Timers & Sessions Phase</h1>
            
            <div class="phase-intro">
                <div class="phase-meta">
                    <div class="meta-item">
                        <span class="meta-label">Duration:</span>
                        <span class="meta-value">Weeks 9-10</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Total Tasks:</span>
                        <span class="meta-value" id="total-tasks">45</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Estimated Time:</span>
                        <span class="meta-value">40-60 hours</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Complexity:</span>
                        <span class="meta-value">Medium (State Management)</span>
                    </div>
                </div>
                
                <div class="phase-goal">
                    <strong>Goal:</strong> Track time spent on projects with persistent timers
                </div>
                
                <p><strong>What you'll build:</strong> A comprehensive time tracking system with play/pause/stop controls, persistent timers that survive page refreshes, work session history, and statistics. The timer will be visible globally and support both project-level and piece-level tracking.</p>
            </div>

            <div class="controls">
                <button class="btn success" onclick="markAllComplete()">‚úì Mark All Complete</button>
                <button class="btn" onclick="markAllIncomplete()">‚óã Mark All Incomplete</button>
                <button class="btn" onclick="exportPhaseProgress()">üìÅ Export Progress</button>
                <button class="btn danger" onclick="resetPhaseProgress()">üîÑ Reset Phase</button>
            </div>

            <div class="deliverable-section">
                <div class="deliverable-header">
                    <h2 class="deliverable-title">Timer Component</h2>
                    <div class="deliverable-progress" id="timer-progress">0 / 15 tasks</div>
                </div>
                <div class="deliverable-content">
                    <div class="task-group">
                        <div class="task-group-title">Basic Timer UI</div>
                        
                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="create-timer-component">
                            <div class="task-content">
                                <div class="task-title">Create Timer component</div>
                                <div class="task-description">Display elapsed time in HH:MM:SS format with clean typography</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="add-timer-controls">
                            <div class="task-content">
                                <div class="task-title">Add play/pause/stop controls</div>
                                <div class="task-description">Green play, orange pause, red stop buttons with icons and tooltips</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-visual-states">
                            <div class="task-content">
                                <div class="task-title">Add timer visual states</div>
                                <div class="task-description">Different colors for stopped, running, paused states with animation</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-keyboard-shortcuts">
                            <div class="task-content">
                                <div class="task-title">Add keyboard shortcuts</div>
                                <div class="task-description">Space to play/pause, S to stop, accessible via global key handler</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-accessibility">
                            <div class="task-content">
                                <div class="task-title">Add timer accessibility</div>
                                <div class="task-description">Screen reader announcements, ARIA labels, focus management</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>
                    </div>

                    <div class="task-group">
                        <div class="task-group-title">Timer Logic & State</div>
                        
                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="implement-timer-state">
                            <div class="task-content">
                                <div class="task-title">Implement timer state management</div>
                                <div class="task-description">TimerState class with StartTime, ElapsedTime, IsRunning properties</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-background-tick">
                            <div class="task-content">
                                <div class="task-title">Add background timer tick</div>
                                <div class="task-description">setInterval every second to update display, handle tab visibility</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-accuracy">
                            <div class="task-content">
                                <div class="task-title">Ensure timer accuracy</div>
                                <div class="task-description">Use DateTime.Now for calculations, not just interval counting</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-pause-resume">
                            <div class="task-content">
                                <div class="task-title">Implement pause/resume logic</div>
                                <div class="task-description">Track elapsed time separately from start time, handle multiple pauses</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-stop-save">
                            <div class="task-content">
                                <div class="task-title">Handle timer stop and session save</div>
                                <div class="task-description">Create WorkSession record when stopped, reset timer state</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>
                    </div>

                    <div class="task-group">
                        <div class="task-group-title">Timer Integration</div>
                        
                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="embed-timer-project-detail">
                            <div class="task-content">
                                <div class="task-title">Embed timer in project detail page</div>
                                <div class="task-description">Timer component in project header with context awareness</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-project-context">
                            <div class="task-content">
                                <div class="task-title">Associate timer with project</div>
                                <div class="task-description">Pass ProjectId to timer, save sessions with correct project reference</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-piece-context">
                            <div class="task-content">
                                <div class="task-title">Add optional pattern piece context</div>
                                <div class="task-description">When working on specific piece, track time per piece</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-multiple-instances">
                            <div class="task-content">
                                <div class="task-title">Handle multiple timer instances</div>
                                <div class="task-description">Only one timer can run at a time, auto-pause others</div>
                            </div>
                            <div class="task-complexity complexity-hard">Hard</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-confirmation-dialogs">
                            <div class="task-content">
                                <div class="task-title">Add confirmation dialogs</div>
                                <div class="task-description">Confirm before stopping long sessions, warn about lost time</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="deliverable-section">
                <div class="deliverable-header">
                    <h2 class="deliverable-title">Timer Persistence</h2>
                    <div class="deliverable-progress" id="persistence-progress">0 / 12 tasks</div>
                </div>
                <div class="deliverable-content">
                    <div class="task-group">
                        <div class="task-group-title">State Persistence</div>
                        
                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="design-timer-storage">
                            <div class="task-content">
                                <div class="task-title">Design timer state storage format</div>
                                <div class="task-description">JSON structure for active timer: ProjectId, PieceId?, StartTime, ElapsedTime, IsRunning</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="implement-timer-storage">
                            <div class="task-content">
                                <div class="task-title">Implement timer state storage</div>
                                <div class="task-description">Save to localStorage immediately on start/pause/stop actions</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-state-restoration">
                            <div class="task-content">
                                <div class="task-title">Restore timer state on page load</div>
                                <div class="task-description">Check localStorage, calculate current elapsed time, resume if running</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-cleanup">
                            <div class="task-content">
                                <div class="task-title">Clean up timer state</div>
                                <div class="task-description">Remove localStorage entry when timer stopped, handle orphaned states</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-browser-close">
                            <div class="task-content">
                                <div class="task-title">Handle browser close/refresh</div>
                                <div class="task-description">beforeunload event to save current state, warn about running timer</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>
                    </div>

                    <div class="task-group">
                        <div class="task-group-title">Cross-Tab Synchronization</div>
                        
                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="implement-storage-events">
                            <div class="task-content">
                                <div class="task-title">Listen for localStorage storage events</div>
                                <div class="task-description">Sync timer state across browser tabs automatically</div>
                            </div>
                            <div class="task-complexity complexity-hard">Hard</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="tab-timer-coordination">
                            <div class="task-content">
                                <div class="task-title">Coordinate timer across tabs</div>
                                <div class="task-description">Only one tab should tick the timer, others should just display</div>
                            </div>
                            <div class="task-complexity complexity-hard">Hard</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="tab-visibility-handling">
                            <div class="task-content">
                                <div class="task-title">Handle tab visibility changes</div>
                                <div class="task-description">Pause updates when tab is hidden, resume when visible</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-conflict-resolution">
                            <div class="task-content">
                                <div class="task-title">Resolve timer conflicts</div>
                                <div class="task-description">When multiple tabs try to control timer, last action wins</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>
                    </div>

                    <div class="task-group">
                        <div class="task-group-title">Error Handling & Recovery</div>
                        
                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-error-recovery">
                            <div class="task-content">
                                <div class="task-title">Handle timer corruption</div>
                                <div class="task-description">Detect invalid timer states, reset gracefully, notify user</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-long-sessions">
                            <div class="task-content">
                                <div class="task-title">Handle very long sessions</div>
                                <div class="task-description">Sessions > 8 hours, warn user, suggest breaking into multiple sessions</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-date-boundary">
                            <div class="task-content">
                                <div class="task-title">Handle date boundary crossing</div>
                                <div class="task-description">Session started yesterday but stopped today, correct date handling</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="deliverable-section">
                <div class="deliverable-header">
                    <h2 class="deliverable-title">Work Sessions</h2>
                    <div class="deliverable-progress" id="sessions-progress">0 / 10 tasks</div>
                </div>
                <div class="deliverable-content">
                    <div class="task-group">
                        <div class="task-group-title">Session Data Management</div>
                        
                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="implement-worksession-model">
                            <div class="task-content">
                                <div class="task-title">Complete WorkSession model implementation</div>
                                <div class="task-description">Id, ProjectId, PatternPieceId?, StartTime, EndTime, UserId with relationships</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="create-session-service">
                            <div class="task-content">
                                <div class="task-title">Create WorkSessionService</div>
                                <div class="task-description">CRUD operations, both offline (IndexedDB) and server modes</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="session-creation-logic">
                            <div class="task-content">
                                <div class="task-title">Implement session creation</div>
                                <div class="task-description">Create session when timer stops, calculate duration, validate data</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="session-validation">
                            <div class="task-content">
                                <div class="task-title">Add session validation</div>
                                <div class="task-description">Minimum session time (1 minute), maximum (12 hours), valid dates</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>
                    </div>

                    <div class="task-group">
                        <div class="task-group-title">Session History UI</div>
                        
                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="create-session-history-page">
                            <div class="task-content">
                                <div class="task-title">Create session history page</div>
                                <div class="task-description">List all sessions with project names, durations, dates</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="session-list-filtering">
                            <div class="task-content">
                                <div class="task-title">Add session filtering</div>
                                <div class="task-description">Filter by project, date range, duration range</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="session-editing">
                            <div class="task-content">
                                <div class="task-title">Allow session editing</div>
                                <div class="task-description">Correct start/end times, delete invalid sessions, split long sessions</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="session-export">
                            <div class="task-content">
                                <div class="task-title">Add session export</div>
                                <div class="task-description">Export sessions to CSV for external analysis</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="project-session-view">
                            <div class="task-content">
                                <div class="task-title">Show sessions on project detail</div>
                                <div class="task-description">Recent sessions list on project page with total time</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="session-notes">
                            <div class="task-content">
                                <div class="task-title">Add optional session notes</div>
                                <div class="task-description">Notes field on WorkSession, editable after session ends</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="deliverable-section">
                <div class="deliverable-header">
                    <h2 class="deliverable-title">Statistics & Global Timer</h2>
                    <div class="deliverable-progress" id="stats-progress">0 / 8 tasks</div>
                </div>
                <div class="deliverable-content">
                    <div class="task-group">
                        <div class="task-group-title">Time Statistics</div>
                        
                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="create-time-statistics-service">
                            <div class="task-content">
                                <div class="task-title">Create time statistics service</div>
                                <div class="task-description">Calculate total time today/week/month/all-time from WorkSessions</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="average-session-calculations">
                            <div class="task-content">
                                <div class="task-title">Calculate session averages</div>
                                <div class="task-description">Average session length, longest session, most productive day of week</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="time-distribution-analysis">
                            <div class="task-content">
                                <div class="task-title">Analyze time distribution</div>
                                <div class="task-description">Time spent per project, per pattern piece, productivity heat maps</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="statistics-dashboard">
                            <div class="task-content">
                                <div class="task-title">Create time statistics dashboard</div>
                                <div class="task-description">Visual charts and stats, accessible from main navigation</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>
                    </div>

                    <div class="task-group">
                        <div class="task-group-title">Global Timer Display</div>
                        
                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="header-timer-display">
                            <div class="task-content">
                                <div class="task-title">Add timer to header/navigation</div>
                                <div class="task-description">Compact timer display visible on all pages when running</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="global-timer-controls">
                            <div class="task-content">
                                <div class="task-title">Global timer controls</div>
                                <div class="task-description">Pause/stop from header, click to navigate to project</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="timer-notifications">
                            <div class="task-content">
                                <div class="task-title">Add timer milestone notifications</div>
                                <div class="task-description">Toast at 30min, 1hr, 2hr marks to encourage breaks</div>
                            </div>
                            <div class="task-complexity complexity-medium">Medium</div>
                        </div>

                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" data-task="browser-tab-title">
                            <div class="task-content">
                                <div class="task-title">Update browser tab title with timer</div>
                                <div class="task-description">Show running time in tab title when timer active</div>
                            </div>
                            <div class="task-complexity complexity-easy">Easy</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="acceptance-criteria">
                <h3>‚úÖ Acceptance Criteria</h3>
                <ul class="criteria-list">
                    <li class="criteria-item">
                        <input type="checkbox" class="criteria-checkbox" data-criteria="timer-start-stop">
                        <div class="criteria-text">User can start/stop timer on project detail page</div>
                    </li>
                    <li class="criteria-item">
                        <input type="checkbox" class="criteria-checkbox" data-criteria="timer-real-time">
                        <div class="criteria-text">Timer counts up in real-time (HH:MM:SS)</div>
                    </li>
                    <li class="criteria-item">
                        <input type="checkbox" class="criteria-checkbox" data-criteria="timer-persistence">
                        <div class="criteria-text">Timer state persists across page refreshes</div>
                    </li>
                    <li class="criteria-item">
                        <input type="checkbox" class="criteria-checkbox" data-criteria="session-creation">
                        <div class="criteria-text">Stopping timer creates a WorkSession record</div>
                    </li>
                    <li class="criteria-item">
                        <input type="checkbox" class="criteria-checkbox" data-criteria="session-history">
                        <div class="criteria-text">Sessions display in history with start/end times</div>
                    </li>
                    <li class="criteria-item">
                        <input type="checkbox" class="criteria-checkbox" data-criteria="piece-timers">
                        <div class="criteria-text">Per-piece timers work independently</div>
                    </li>
                    <li class="criteria-item">
                        <input type="checkbox" class="criteria-checkbox" data-criteria="global-visibility">
                        <div class="criteria-text">Timer shows in header/nav when active (global visibility)</div>
                    </li>
                    <li class="criteria-item">
                        <input type="checkbox" class="criteria-checkbox" data-criteria="statistics-accuracy">
                        <div class="criteria-text">Statistics calculate correctly</div>
                    </li>
                </ul>
            </div>
        </div>
    </main>

        <script src="shared.js"></script>
    <script>
        initializePhaseTracker({
            phaseNumber: 4,
            phaseTitle: "Kit Management",
            taskIds: [
                "create-kit-entities", "create-kit-dtos", "create-kit-services",
                "implement-kit-crud", "create-kit-list-page", "create-kit-detail-page",
                "add-kit-builder", "implement-kit-components", "create-kit-templates",
                "add-kit-versioning", "implement-kit-duplication", "create-kit-sharing",
                "add-kit-cost-calculation", "implement-kit-inventory-linking",
                "create-kit-assembly-instructions", "add-kit-images",
                "implement-kit-variations", "create-kit-bundling",
                "add-kit-pricing", "implement-kit-availability-checking",
                "create-kit-wishlist", "add-kit-comparison",
                "implement-kit-recommendations", "create-kit-history",
                "add-kit-archiving", "implement-kit-restore",
                "create-kit-bulk-operations", "add-kit-export"
            ],
            criteriaIds: [
                "kit-builder-functional", "kit-inventory-linked", "kit-cost-accurate",
                "kit-assembly-clear", "kit-availability-realtime"
            ]
        });

    </script>
</body>
</html>
