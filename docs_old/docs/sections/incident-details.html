<!-- Incident Details Section Content -->
<div class="incident-header mb-6">
    <div class="flex items-center gap-4">
        <button class="btn btn-secondary" onclick="window.TankerMadeRouter.goToSection('incidents')">
            ‚Üê Back to Incidents
        </button>
        <div class="flex-1">
            <div class="flex items-center gap-3 mb-2">
                <h1 class="text-2xl font-bold" id="incident-title">Incident #123</h1>
                <span class="badge badge-warning" id="incident-severity">High</span>
                <span class="badge badge-error" id="incident-status">Open</span>
            </div>
            <p class="text-secondary" id="incident-summary">Authentication token expiry causes 401 loops</p>
        </div>
        <div class="flex gap-2">
            <button class="btn btn-success" onclick="resolveIncident()">
                ‚úÖ Resolve
            </button>
            <button class="btn btn-warning" onclick="updateIncident()">
                ‚úèÔ∏è Update
            </button>
            <button class="btn btn-secondary" onclick="duplicateIncident()">
                üìã Duplicate
            </button>
        </div>
    </div>
</div>

<div class="grid grid-cols-5 gap-4 mb-6">
    <div class="card text-center">
        <div class="card-body">
            <div class="text-lg font-bold text-error">High</div>
            <div class="text-sm text-secondary">Severity</div>
        </div>
    </div>
    <div class="card text-center">
        <div class="card-body">
            <div class="text-lg font-bold text-warning">Open</div>
            <div class="text-sm text-secondary">Status</div>
        </div>
    </div>
    <div class="card text-center">
        <div class="card-body">
            <div class="text-lg font-bold text-primary">Phase 1</div>
            <div class="text-sm text-secondary">Related Phase</div>
        </div>
    </div>
    <div class="card text-center">
        <div class="card-body">
            <div class="text-lg font-bold text-primary">2h 15m</div>
            <div class="text-sm text-secondary">Open For</div>
        </div>
    </div>
    <div class="card text-center">
        <div class="card-body">
            <div class="text-lg font-bold text-primary">Developer</div>
            <div class="text-sm text-secondary">Assigned To</div>
        </div>
    </div>
</div>

<div class="grid grid-cols-3 gap-6">
    <div class="col-span-2">
        <div class="card mb-6">
            <div class="card-header">
                <h3 class="card-title">Description</h3>
            </div>
            <div class="card-body">
                <div class="incident-description">
                    <p class="mb-4">Users are experiencing authentication loops when their JWT tokens expire during active sessions. The application fails to properly refresh tokens, causing continuous 401 responses.</p>

                    <h4 class="font-semibold mb-2">Steps to Reproduce:</h4>
                    <ol class="list-decimal pl-6 mb-4 space-y-1">
                        <li>Log into the application</li>
                        <li>Wait for token expiry (15 minutes)</li>
                        <li>Attempt to perform any authenticated action</li>
                        <li>Observe continuous redirect to login page</li>
                    </ol>

                    <h4 class="font-semibold mb-2">Expected Behavior:</h4>
                    <p class="mb-4">The application should automatically refresh the token in the background or gracefully handle expiry by prompting for re-authentication once.</p>

                    <h4 class="font-semibold mb-2">Actual Behavior:</h4>
                    <p class="mb-4">Continuous loop between login page and application, preventing any further use until browser data is cleared.</p>

                    <div class="p-4 bg-red-50 border-l-4 border-red-500 rounded">
                        <h4 class="font-semibold text-red-800 mb-2">Impact:</h4>
                        <p class="text-red-700">Blocks Phase 1 completion. Users cannot test authentication flows properly.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="flex items-center justify-between">
                    <h3 class="card-title">Comments & Updates</h3>
                    <button class="btn btn-sm btn-primary" onclick="addComment()">
                        üí¨ Add Comment
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="space-y-4" id="comments-list">
                    <div class="comment-item">
                        <div class="flex items-start gap-3">
                            <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-content text-white text-sm font-semibold">
                                D
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="font-semibold">Developer</span>
                                    <span class="text-xs text-secondary">2 hours ago</span>
                                </div>
                                <p class="text-sm">I've identified the issue in the AuthenticationService. The token refresh logic is missing proper error handling.</p>
                            </div>
                        </div>
                    </div>

                    <div class="comment-item">
                        <div class="flex items-start gap-3">
                            <div class="w-8 h-8 bg-secondary rounded-full flex items-center justify-content text-white text-sm font-semibold">
                                S
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="font-semibold">System</span>
                                    <span class="text-xs text-secondary">1 hour ago</span>
                                    <span class="badge badge-info">Status Change</span>
                                </div>
                                <p class="text-sm">Status changed from <strong>New</strong> to <strong>In Progress</strong></p>
                            </div>
                        </div>
                    </div>

                    <div class="comment-item">
                        <div class="flex items-start gap-3">
                            <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-content text-white text-sm font-semibold">
                                D
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="font-semibold">Developer</span>
                                    <span class="text-xs text-secondary">30 minutes ago</span>
                                </div>
                                <p class="text-sm">Working on a fix. Will implement proper token refresh with exponential backoff. ETA: 1 hour.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-4 p-4 bg-gray-50 rounded-lg" id="add-comment-form" style="display: none;">
                    <textarea class="form-input w-full mb-2" rows="3" placeholder="Add your comment..."></textarea>
                    <div class="flex justify-end gap-2">
                        <button class="btn btn-sm btn-secondary" onclick="cancelComment()">Cancel</button>
                        <button class="btn btn-sm btn-primary" onclick="submitComment()">Post Comment</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div>
        <div class="card mb-4">
            <div class="card-header">
                <h3 class="card-title">GitHub Integration</h3>
            </div>
            <div class="card-body">
                <div class="space-y-3">
                    <a href="https://github.com/ProbablyBadAtThis/TankerMade/issues/123" target="_blank" class="btn btn-sm btn-primary w-full">
                        üîó View on GitHub
                    </a>
                    <button class="btn btn-sm btn-secondary w-full" onclick="syncWithGitHub()">
                        üîÑ Sync from GitHub
                    </button>
                    <button class="btn btn-sm btn-secondary w-full" onclick="createBranch()">
                        üåø Create Fix Branch
                    </button>
                </div>

                <div class="mt-4 p-3 bg-gray-50 rounded">
                    <h4 class="font-semibold text-sm mb-2">GitHub Info</h4>
                    <div class="space-y-1 text-xs">
                        <div class="flex justify-between">
                            <span class="text-secondary">Issue #:</span>
                            <span>123</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-secondary">Labels:</span>
                            <span>bug, auth</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-secondary">Milestone:</span>
                            <span>Phase 1</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">
                <h3 class="card-title">Related Items</h3>
            </div>
            <div class="card-body">
                <div class="space-y-2">
                    <a href="#dev-tracker-phase/1" class="btn btn-sm btn-secondary w-full" data-section="dev-tracker-phase" data-param-phaseId="1">
                        üìä Phase 1 Tasks
                    </a>
                    <a href="#workbench-section/technical-specs" class="btn btn-sm btn-secondary w-full" data-section="workbench-section" data-param-section="technical-specs">
                        üìã Auth Specs
                    </a>
                    <button class="btn btn-sm btn-secondary w-full" onclick="viewRelatedIncidents()">
                        üö® Related Issues (0)
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Incident Timeline</h3>
            </div>
            <div class="card-body">
                <div class="space-y-3 text-sm">
                    <div class="timeline-item">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-error rounded-full"></div>
                            <span class="font-semibold">Created</span>
                        </div>
                        <div class="text-xs text-secondary ml-4">2 hours ago</div>
                    </div>

                    <div class="timeline-item">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-warning rounded-full"></div>
                            <span class="font-semibold">Assigned</span>
                        </div>
                        <div class="text-xs text-secondary ml-4">1.5 hours ago</div>
                    </div>

                    <div class="timeline-item">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-info rounded-full"></div>
                            <span class="font-semibold">In Progress</span>
                        </div>
                        <div class="text-xs text-secondary ml-4">1 hour ago</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.incident-description h4 {
    color: var(--color-text-primary);
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
}

.comment-item {
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--color-border);
}

.comment-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.timeline-item {
    position: relative;
    padding-left: 1rem;
}

.timeline-item:not(:last-child)::after {
    content: '';
    position: absolute;
    left: 4px;
    top: 1.5rem;
    width: 1px;
    height: 1.5rem;
    background: var(--color-border);
}

@media (max-width: 768px) {
    .grid-cols-5 {
        grid-template-columns: repeat(2, 1fr);
    }

    .grid-cols-3 {
        grid-template-columns: 1fr;
    }

    .col-span-2 {
        grid-column: span 1;
    }

    .incident-header .flex {
        flex-direction: column;
        align-items: stretch;
        gap: 1rem;
    }
}
</style>